{"version":3,"file":"ui.min.js","sources":["../src/ui.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny C4L UI.\n *\n * @module      tiny_c4l/ui\n * @copyright   2022 Marc Catal√† <reskit@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {component} from './common';\nimport C4LModal from './modal';\nimport ModalFactory from 'core/modal_factory';\n//import {components as Components} from './components';\nimport {get_strings as getStrings} from 'core/str';\nimport {\n    isStudent,\n    getallowedComponents,\n    showPreview\n} from './options';\nimport ModalEvents from 'core/modal_events';\nimport {\n    addVariant,\n    getVariantsClass,\n    getVariantHtml,\n    getVariantsHtml,\n    loadVariantPreferences,\n    removeVariant,\n    saveVariantPreferences,\n    setVariants,\n    variantExists\n} from './variantslib';\nimport {call as fetchMany} from 'core/ajax';\n\nlet userStudent = false;\nlet previewC4L = true;\nlet allowedComponents = [];\nlet components = null;\nlet categories = null;\nlet flavors = null;\nlet langStrings = {};\n\nlet currentFlavor = '';\nlet currentCategoryId = 1;\n\n/**\n * Handle action\n *\n * @param {TinyMCE} editor\n */\nexport const handleAction = async(editor) => {\n    if (!components) {\n        components = await getComponents();\n    }\n    if (!categories) {\n        categories = await getCategories();\n    }\n    if (!flavors) {\n        flavors = await getFlavors();\n    }\n    userStudent = isStudent(editor);\n    previewC4L = showPreview(editor);\n    langStrings = await getAllStrings();\n    allowedComponents = getallowedComponents(editor);\n    loadVariantPreferences().then(() => displayDialogue(editor));\n};\n\n/**\n * Display modal\n *\n * @param  {TinyMCE} editor\n */\nconst displayDialogue = async(editor) => {\n    const data = Object.assign({}, {});\n    const templateContext = await getTemplateContext(editor, data);\n    // Show modal with buttons.\n    const modal = await ModalFactory.create({\n        type: C4LModal.TYPE,\n        templateContext: templateContext,\n        large: true,\n    });\n\n    // Set modal size when no preview.\n    if (!previewC4L) {\n        editor.targetElm.closest('body').classList.add('c4l-modal-no-preview');\n    }\n    modal.show();\n\n    // Event modal listener.\n    modal.getRoot().on(ModalEvents.hidden, () => {\n        handleModalHidden(editor);\n    });\n\n    // Event filters listener.\n    const filters = modal.getRoot()[0].querySelectorAll('.c4l-button-filter');\n    filters.forEach(node => {\n        node.addEventListener('click', (event) => {\n            handleButtonFilterClick(event, modal);\n        });\n    });\n\n    // Event flavor selector listener.\n    const flavorbuttons = modal.getRoot()[0].querySelectorAll('.c4l-button-flavor');\n    flavorbuttons.forEach(node => {\n        node.addEventListener('click', (event) => {\n            handleButtonFlavorClick(event, modal);\n        });\n    });\n\n    // Event buttons listeners.\n    const buttons = modal.getRoot()[0].querySelectorAll('.c4lt-dialog-button');\n    buttons.forEach(node => {\n        node.addEventListener('click', (event) => {\n            handleButtonClick(event, editor, modal);\n        });\n        if (previewC4L) {\n            node.addEventListener('mouseenter', (event) => {\n                handleButtonMouseEvent(event, modal, true);\n            });\n            node.addEventListener('mouseleave', (event) => {\n                handleButtonMouseEvent(event, modal, false);\n            });\n        }\n    });\n\n    // Event variants listeners.\n    const variants = modal.getRoot()[0].querySelectorAll('.c4l-button-variant');\n    variants.forEach(node => {\n        node.addEventListener('click', (event) => {\n            handleVariantClick(event, modal);\n        });\n        if (previewC4L) {\n            node.addEventListener('mouseenter', (event) => {\n                handleVariantMouseEvent(event, modal, true);\n            });\n            node.addEventListener('mouseleave', (event) => {\n                handleVariantMouseEvent(event, modal, false);\n            });\n        }\n    });\n};\n\n/**\n * Handle a click within filter button.\n *\n * @param {MouseEvent} event The change event\n * @param {obj} modal\n */\nconst handleButtonFilterClick = (event, modal) => {\n    const button = event.target.closest('button');\n    const currentCategoryId = button.dataset.filter;\n\n    const buttons = modal.getRoot()[0].querySelectorAll('.c4l-buttons-filters button');\n    buttons.forEach(node => node.classList.remove('c4l-button-filter-enabled'));\n    button.classList.add('c4l-button-filter-enabled');\n\n    // Show/hide component buttons.\n    showCategoryButtons(modal, currentCategoryId);\n};\n\nconst handleButtonFlavorClick = (event, modal) => {\n    const button = event.target.closest('button');\n    currentFlavor = button.dataset.flavor;\n\n    const buttons = modal.getRoot()[0].querySelectorAll('.c4l-buttons-flavors button');\n    buttons.forEach(node => node.classList.remove('c4l-button-flavor-enabled'));\n    button.classList.add('c4l-button-flavor-enabled');\n    const componentButtons = modal.getRoot()[0].querySelectorAll('.c4l-buttons-preview button');\n    componentButtons.forEach(componentButton => {\n        console.log(\"new class\")\n        console.log(currentFlavor)\n        // TODO remove old class :)\n        componentButton.querySelector('.c4l-button-text').classList.add(currentFlavor);\n    });\n};\n\n/**\n * Handle when closing the Modal.\n *\n * @param {obj} editor\n */\nconst handleModalHidden = (editor) => {\n    editor.targetElm.closest('body').classList.remove('c4l-modal-no-preview');\n    saveVariantPreferences();\n};\n\nconst updateComponentCode = (componentCode, selectedButton, placeholder) => {\n    componentCode = componentCode.replace('{{PLACEHOLDER}}', placeholder);\n\n    // Return active variants for current component.\n    const variants = getVariantsClass(components[selectedButton].name);\n\n    // Apply variants to html component.\n    if (variants.length > 0) {\n        componentCode = componentCode.replace('{{VARIANTS}}', variants.join(' '));\n        componentCode = componentCode.replace('{{VARIANTSHTML}}', getVariantsHtml(components[selectedButton].name));\n    } else {\n        componentCode = componentCode.replace('{{VARIANTS}}', '');\n        componentCode = componentCode.replace('{{VARIANTSHTML}}', '');\n    }\n\n    if (currentFlavor) {\n        componentCode = componentCode.replace('{{FLAVOR}}', currentFlavor);\n    } else {\n        componentCode = componentCode.replace('{{FLAVOR}}', '');\n    }\n\n    // Apply random IDs.\n    componentCode = applyRandomID(componentCode);\n\n    // Apply lang strings.\n    componentCode = applyLangStrings(componentCode);\n\n    return componentCode;\n}\n\n/**\n * Handle a click in a component button.\n *\n * @param {MouseEvent} event The click event\n * @param {obj} editor\n * @param {obj} modal\n */\nconst handleButtonClick = async (event, editor, modal) => {\n    const selectedButton = event.target.closest('button').dataset.id;\n\n    // Component button.\n    if (components[selectedButton]) {\n        const sel = editor.selection.getContent();\n        let componentCode = components[selectedButton].code;\n        const placeholder = (sel.length > 0 ? sel : components[selectedButton].text);\n\n        // Create a new node to replace the placeholder.\n        const randomId = generateRandomID();\n        const newNode = document.createElement('span');\n        newNode.dataset.id = randomId;\n        newNode.innerHTML = placeholder;\n        componentCode = updateComponentCode(componentCode, selectedButton, newNode.outerHTML);\n        // Sets new content.\n        editor.selection.setContent(componentCode);\n\n        // Select text.\n        const nodeSel = editor.dom.select('span[data-id=\"' + randomId + '\"]');\n        if (nodeSel?.[0]) {\n            editor.selection.select(nodeSel[0]);\n        }\n\n        modal.destroy();\n        editor.focus();\n    }\n};\n\n/**\n * Handle a mouse events mouseenter/mouseleave in a component button.\n *\n * @param {MouseEvent} event The click event\n * @param {obj} modal\n * @param {bool} show\n */\nconst handleButtonMouseEvent = (event, modal, show) => {\n    const selectedButton = event.target.closest('button').dataset.id;\n    const node = modal.getRoot()[0].querySelector('div[data-id=\"code-preview-' + selectedButton + '\"]');\n    const previewDefault = modal.getRoot()[0].querySelector('div[data-id=\"code-preview-default\"]');\n\n    node.innerHTML = updateComponentCode(components[selectedButton].code, selectedButton, 'Lorem ipsum');\n\n    if (node) {\n        if (show) {\n            previewDefault.classList.toggle('c4l-hidden');\n            node.classList.toggle('c4l-hidden');\n        } else {\n            node.classList.toggle('c4l-hidden');\n            previewDefault.classList.toggle('c4l-hidden');\n        }\n    }\n};\n\n/**\n * Handle a mouse events mouseenter/mouseleave in a variant button.\n *\n * @param {MouseEvent} event The mouseenter/mouseleave event\n * @param {obj} modal\n * @param {bool} show\n */\nconst handleVariantMouseEvent = (event, modal, show) => {\n    const variant = event.target.closest('span');\n    const variantEnabled = variant.dataset.state == 'on';\n    const button = event.target.closest('button');\n\n    if (!variantEnabled) {\n        updateVariantComponentState(variant, button, modal, show, false);\n    }\n};\n\n\n/**\n * Handle a mouse event within the variant buttons.\n *\n * @param {MouseEvent} event The mouseenter/mouseleave event\n * @param {obj} modal\n */\nconst handleVariantClick = (event, modal) => {\n    event.stopPropagation();\n    const variant = event.target.closest('span');\n    const button = event.target.closest('button');\n    updateVariantComponentState(variant, button, modal, false, true);\n};\n\n/**\n * Get the template context for the dialogue.\n *\n * @param {Editor} editor\n * @param {object} data\n * @returns {object} data\n */\nconst getTemplateContext = async (editor, data) => {\n    console.log('template context')\n    console.log(flavors)\n    return Object.assign({}, {\n        elementid: editor.id,\n        buttons: await getButtons(editor),\n        filters: await getFilters(),\n        flavors: flavors,\n        preview: previewC4L,\n    }, data);\n};\n\n/**\n * Get the C4L filters for the dialogue.\n *\n * @returns {object} data\n */\nconst getFilters = async () => {\n    const filters = [];\n    //const stringValues = await getStrings(Contexts.map((key) => ({key, component})));\n    // Iterate over contexts.\n    categories.forEach((category) => {\n        filters.push({\n            name: category.displayname,\n            type: category.id,\n            filterClass: category.order === 1 ? 'c4l-button-filter-enabled' : '',\n        });\n    });\n\n    return filters;\n};\n\n/**\n * Get the C4L filters for the dialogue.\n *\n * @returns {object} data\n */\nconst getFlavors = async () => {\n    const flavorRecords = await fetchMany([{\n        methodname: 'tiny_c4l_get_flavors',\n        args: {},\n    }])[0];\n    const flavorsToStore = [];\n    flavorRecords.forEach(flavor => {\n        flavorsToStore.push({\n            flavor: flavor.name,\n            name: flavor.displayname,\n        });\n    });\n    return flavorsToStore;\n};\n\nconst getComponentVariants = (component, variants) => {\n    const componentVariants = [];\n    component.variants.forEach(variant => {\n        if (variants[variant] !== undefined) {\n            componentVariants.push({\n                name: variant,\n                state: 'off',\n                imageClass: 'c4l-' + variant + '-variant-off',\n                title: langStrings.get(variant),\n                content: variants[variant].content,\n            });\n        }\n    });\n    return componentVariants;\n};\n\n/**\n * Get the C4L buttons for the dialogue.\n *\n * @param {Editor} editor\n * @returns {object} buttons\n */\nconst getButtons = async (editor) => {\n    const buttons = [];\n    const sel = editor.selection.getContent();\n    let componentCode = '';\n    let placeholder = '';\n    const variants = await getVariants();\n    setVariants(variants);\n    const components = await getComponents();\n\n    console.log(components);\n    Object.values(components).forEach(component => {\n        buttons.push({\n            id: component.id, // TODO do dynamically, maybe we do not need an id\n            name: component.displayname,\n            type: component.compcat,\n            imageClass: 'c4l-' + component.imageclass,\n            htmlcode: component.code,\n            variants: getComponentVariants(component, variants),\n        });\n    });\n    console.log(buttons);\n\n    return buttons;\n};\n\nconst getVariants = async() => {\n    const variants = await fetchMany([{\n        methodname: 'tiny_c4l_get_variants',\n        args: {},\n    }])[0];\n\n    const indexedVariants = [];\n    variants.forEach(variant => {\n        indexedVariants[variant.name] = variant;\n    });\n    console.log(indexedVariants);\n    return indexedVariants;\n};\n\nconst getComponents = async() => {\n    const components = await fetchMany([{\n        methodname: 'tiny_c4l_get_components',\n        args: {},\n    }])[0];\n\n    // TODO error handling\n    const indexedComponents = [];\n    components.forEach(component => {\n        indexedComponents[component.id] = component;\n    });\n    return indexedComponents;\n};\n\nconst getCategories = async() => {\n    const categories = await fetchMany([{\n        methodname: 'tiny_c4l_get_compcats',\n        args: {},\n    }])[0];\n    return categories;\n};\n\n\n/**\n * Get variants for the dialogue.\n *\n * @param  {string} component\n * @param  {object} elements\n * @return {object} Variants for a component\n */\nconst getVariantsState = (component, elements) => {\n    const variants = [];\n    let variantState = '';\n    let variantClass = '';\n\n    // Max 3 variants.\n    if (elements.length > 3) {\n        elements = elements.slice(0, 2);\n    }\n\n    elements.forEach((variant, index) => {\n        if (variantExists(component, variant)) {\n            variantState = 'on';\n            variantClass = 'on ';\n        } else {\n            variantState = 'off';\n            variantClass = '';\n        }\n        variantClass += variant + '-variant-' + variantState;\n        variants.push({\n            id: index,\n            name: variant,\n            state: variantState,\n            imageClass: variantClass,\n            title: langStrings.get(variant),\n        });\n    });\n\n    return variants;\n};\n\n/**\n * Update a variant component UI.\n *\n * @param {obj} variant\n * @param {obj} button\n * @param {obj} modal\n * @param {bool} show\n * @param {bool} updateHtml\n */\nconst updateVariantComponentState = (variant, button, modal, show, updateHtml) => {\n    console.log(variant);\n    const selectedVariant = 'c4l-' + variant.dataset.variant + '-variant';\n    const selectedButton = button.dataset.id;\n    const componentClass = button.dataset.classcomponent;\n    const previewComponent = modal.getRoot()[0]\n        .querySelector('div[data-id=\"code-preview-' + selectedButton + '\"] .' + componentClass);\n    const variantPreview = modal.getRoot()[0]\n        .querySelector('span[data-id=\"variantHTML-' + selectedButton + '\"]');\n    let variantsHtml = '';\n\n    if (previewComponent) {\n        if (updateHtml) {\n            if (variant.dataset.state == 'on') {\n                removeVariant(components[selectedButton].name, variant.dataset.variant);\n                updateVariantButtonState(variant, false);\n                previewComponent.classList.remove(selectedVariant);\n            } else {\n                addVariant(components[selectedButton].name, variant.dataset.variant);\n                updateVariantButtonState(variant, true);\n                previewComponent.classList.add(selectedVariant);\n            }\n\n            // Update variant preview HTML.\n            if (variantPreview) {\n                variantPreview.innerHTML = getVariantsHtml(components[selectedButton].name);\n            }\n        } else {\n            variantsHtml = getVariantsHtml(components[selectedButton].name);\n            if (show) {\n                previewComponent.classList.add(selectedVariant);\n                variantsHtml += getVariantHtml(variant.dataset.variant);\n            } else {\n                previewComponent.classList.remove(selectedVariant);\n            }\n\n            // Update variant preview HTML.\n            if (variantPreview) {\n                variantPreview.innerHTML = variantsHtml;\n            }\n        }\n    } else {\n        // Update variants preferences.\n        if (variant.dataset.state == 'on') {\n            removeVariant(components[selectedButton].name, variant.dataset.variant);\n            updateVariantButtonState(variant, false);\n        } else {\n            addVariant(components[selectedButton].name, variant.dataset.variant);\n            updateVariantButtonState(variant, true);\n        }\n    }\n};\n\n/**\n * Update a variant button UI.\n *\n * @param {obj} variant\n * @param {bool} activate\n */\nconst updateVariantButtonState = (variant, activate) => {\n    if (activate) {\n        variant.dataset.state = 'on';\n        variant.classList.remove(variant.dataset.variant + '-variant-off');\n        variant.classList.add(variant.dataset.variant + '-variant-on');\n        variant.classList.add('on');\n    } else {\n        variant.dataset.state = 'off';\n        variant.classList.remove(variant.dataset.variant + '-variant-on');\n        variant.classList.add(variant.dataset.variant + '-variant-off');\n        variant.classList.remove('on');\n    }\n};\n\n/**\n * Show/hide buttons depend on selected context.\n *\n * @param  {object} modal\n * @param  {String} context\n */\nconst showCategoryButtons = (modal, context) => {\n    const showNodes = modal.getRoot()[0].querySelectorAll('button[data-type=\"' + context + '\"]');\n    const hideNodes = modal.getRoot()[0].querySelectorAll('button[data-type]:not([data-type=\"' + context + '\"])');\n\n    showNodes.forEach(node => node.classList.remove('c4l-hidden'));\n    hideNodes.forEach(node => node.classList.add('c4l-hidden'));\n};\n\n/**\n * Replace all localized strings.\n *\n * @param  {String} text\n * @return {String} String with lang tags replaced with a localized string.\n */\nconst applyLangStrings = (text) => {\n    const compRegex = /{{#([^}]*)}}/g;\n\n    [...text.matchAll(compRegex)].forEach(strLang => {\n        text = text.replace('{{#' + strLang[1] + '}}', langStrings.get(strLang[1]));\n    });\n\n    return text;\n};\n\n/**\n * Generates a random string.\n * @return {string} A random string\n */\nconst generateRandomID = () => {\n    const timestamp = new Date().getTime();\n    return 'R' + Math.round(Math.random() * 100000) + '-' + timestamp;\n};\n\n/**\n * Replace all ID tags with a random string.\n * @param  {String} text\n * @return {String} String with all ID tags replaced with a random string.\n */\nconst applyRandomID = (text) => {\n    const compRegex = /{{@ID}}/g;\n\n    if (text.match(compRegex)) {\n        text = text.replace(compRegex, generateRandomID());\n    }\n\n    return text;\n};\n\n/**\n * Get language strings.\n *\n * @return {object} Language strings\n */\nconst getAllStrings = async() => {\n    const keys = [];\n    const compRegex = /{{#([^}]*)}}/g;\n\n    components.forEach(element => {\n        keys.push(element.name);\n        element.variants.forEach(variant => {\n            if (keys.indexOf(variant) === -1) {\n                keys.push(variant);\n            }\n        });\n        // Get lang strings from components.\n        [...element.code.matchAll(compRegex)].forEach(strLang => {\n            if (keys.indexOf(strLang[1]) === -1) {\n                keys.push(strLang[1]);\n            }\n        });\n    });\n\n    const stringValues = await getStrings(keys.map((key) => ({key, component})));\n    return new Map(keys.map((key, index) => ([key, stringValues[index]])));\n};\n"],"names":["userStudent","previewC4L","allowedComponents","components","categories","flavors","langStrings","currentFlavor","async","getComponents","getCategories","getFlavors","editor","getAllStrings","then","displayDialogue","data","Object","assign","templateContext","getTemplateContext","modal","ModalFactory","create","type","C4LModal","TYPE","large","targetElm","closest","classList","add","show","getRoot","on","ModalEvents","hidden","handleModalHidden","querySelectorAll","forEach","node","addEventListener","event","handleButtonFilterClick","handleButtonFlavorClick","handleButtonClick","handleButtonMouseEvent","handleVariantClick","handleVariantMouseEvent","button","target","currentCategoryId","dataset","filter","remove","showCategoryButtons","flavor","componentButton","console","log","querySelector","updateComponentCode","componentCode","selectedButton","placeholder","replace","variants","name","length","join","applyRandomID","applyLangStrings","id","sel","selection","getContent","code","text","randomId","generateRandomID","newNode","document","createElement","innerHTML","outerHTML","setContent","nodeSel","dom","select","destroy","focus","previewDefault","toggle","variant","variantEnabled","state","updateVariantComponentState","stopPropagation","elementid","buttons","getButtons","filters","getFilters","preview","category","push","displayname","filterClass","order","flavorRecords","methodname","args","flavorsToStore","getComponentVariants","component","componentVariants","undefined","imageClass","title","get","content","getVariants","values","compcat","imageclass","htmlcode","indexedVariants","indexedComponents","updateHtml","selectedVariant","componentClass","classcomponent","previewComponent","variantPreview","variantsHtml","updateVariantButtonState","activate","context","showNodes","hideNodes","matchAll","strLang","timestamp","Date","getTime","Math","round","random","compRegex","match","keys","element","indexOf","stringValues","map","key","Map","index"],"mappings":"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"}