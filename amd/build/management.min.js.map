{"version":3,"file":"management.min.js","sources":["../src/management.js"],"sourcesContent":["import ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\nimport {exception as displayException, deleteCancelPromise} from 'core/notification';\nimport {call as fetchMany} from 'core/ajax';\n\nexport const init = async() => {\n\n    // Add listener for adding a new source.\n    // let addsource = document.getElementById('addsource');\n    // addsource.addEventListener('click', async(e) => {\n    //     showModal(e, 0);\n    // });\n\n    // Add listener to edit sources.\n    let editsources = document.getElementsByClassName('edit');\n    editsources.forEach(element => {\n        element.addEventListener('click', async(e) => {\n            showModal(e, element.dataset.id, element.dataset.table);\n        });\n    });\n\n    // Add listener to delete sources.\n    let deletesources = document.getElementsByClassName('delete');\n    deletesources.forEach(element => {\n        element.addEventListener('click', async(e) => {\n            deleteModal(e, element.dataset.id, element.dataset.title, element.dataset.table);\n        });\n    });\n};\n\n/**\n * Show dynamic form to add/edit a source.\n * @param {*} e\n * @param {*} id\n * @param {*} table\n */\nfunction showModal(e, id, table) {\n    e.preventDefault();\n    let title;\n    if (id === 0) {\n        title = getString('addsource', 'repository_imagehub');\n    } else {\n        title = getString('editsource', 'repository_imagehub');\n    }\n\n    const modalForm = new ModalForm({\n        // Set formclass, depending on component.\n        formClass: \"tiny_c4l\\\\form\\\\management_\" + table + \"_form\",\n        args: {\n            id: id,\n        },\n        modalConfig: {title: title},\n    });\n    // Reload page after submit.\n    modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => location.reload());\n\n    modalForm.show();\n}\n\n/**\n * Show dynamic form to delete a source.\n * @param {*} e\n * @param {*} id\n * @param {*} title\n * @param {*} table\n */\nfunction deleteModal(e, id, title, table) {\n    e.preventDefault();\n\n    deleteCancelPromise(\n        getString('delete', 'tiny_c4l', title),\n        getString('deletewarning', 'tiny_c4l'),\n    ).then(async() => {\n        if (id !== 0) {\n            try {\n                console.log(id);\n                console.log(table);\n                const deleted = await deleteItem(id, table);\n                if (deleted) {\n                    const link = document.querySelector('[data-table=\"' + table + '\"][data-id=\"' + id + '\"]');\n                    if (link) {\n                        const card = link.closest(\".item\");\n                        card.remove();\n                    }\n                }\n            } catch (error) {\n                displayException(error);\n            }\n        }\n        return;\n    }).catch(() => {\n        return;\n    });\n}\n\n/**\n * Delete c4l items.\n * @param {*} id\n * @param {*} table\n * @returns {mixed}\n */\nexport const deleteItem = (\n    id,\n    table,\n) => fetchMany(\n    [{\n    methodname: 'tiny_c4l_delete_item',\n    args: {\n        id,\n        table,\n}}])[0];\n"],"names":["async","document","getElementsByClassName","forEach","element","addEventListener","e","id","table","title","preventDefault","modalForm","ModalForm","formClass","args","modalConfig","events","FORM_SUBMITTED","location","reload","show","showModal","dataset","then","console","log","deleteItem","link","querySelector","closest","remove","error","catch","deleteModal","methodname"],"mappings":"uVAKoBA,UASEC,SAASC,uBAAuB,QACtCC,SAAQC,UAChBA,QAAQC,iBAAiB,SAASL,MAAAA,cAoBvBM,EAAGC,GAAIC,WAElBC,MADJH,EAAEI,iBAGED,MADO,IAAPF,IACQ,mBAAU,YAAa,wBAEvB,mBAAU,aAAc,6BAG9BI,UAAY,IAAIC,mBAAU,CAE5BC,UAAW,8BAAgCL,MAAQ,QACnDM,KAAM,CACFP,GAAIA,IAERQ,YAAa,CAACN,MAAOA,SAGzBE,UAAUN,iBAAiBM,UAAUK,OAAOC,gBAAgB,IAAMC,SAASC,WAE3ER,UAAUS,OAvCFC,CAAUf,EAAGF,QAAQkB,QAAQf,GAAIH,QAAQkB,QAAQd,aAKrCP,SAASC,uBAAuB,UACtCC,SAAQC,UAClBA,QAAQC,iBAAiB,SAASL,MAAAA,cA0CrBM,EAAGC,GAAIE,MAAOD,OAC/BF,EAAEI,wDAGE,mBAAU,SAAU,WAAYD,QAChC,mBAAU,gBAAiB,aAC7Bc,MAAKvB,aACQ,IAAPO,OAEIiB,QAAQC,IAAIlB,IACZiB,QAAQC,IAAIjB,gBACUkB,WAAWnB,GAAIC,OACxB,OACHmB,KAAO1B,SAAS2B,cAAc,gBAAkBpB,MAAQ,eAAiBD,GAAK,SAChFoB,KAAM,CACOA,KAAKE,QAAQ,SACrBC,WAGf,MAAOC,mCACYA,WAI1BC,OAAM,SAjEDC,CAAY3B,EAAGF,QAAQkB,QAAQf,GAAIH,QAAQkB,QAAQb,MAAOL,QAAQkB,QAAQd,oBA4EzEkB,WAAa,CACtBnB,GACAC,SACC,cACD,CAAC,CACD0B,WAAY,uBACZpB,KAAM,CACFP,GAAAA,GACAC,MAAAA,UACH"}